<template>
    <div class="jumbotron jumbotron-fluid">
        <div id="endRules" style="display:none">
            <h2>Вы успешно прошли обучение и заработали свои первые {{ score }} баллов!</h2>
            <p style="text-align:center">Ожидайте автоматического перенаправления к списку заданий.</p>
        </div>
        <div id="rules-1" class="container">
            <h2>Цель квеста</h2>
            <p>Набрать максимальное количество очков, выполняя задания, размещенные на сайте.</p>
            <h2>Участники</h2>
            <p>Участвовать в квесте возможно только в составе команды. Команда должна состоять из ___ человек, среди которых обязательные должности: Капитан, корреспондент, местный…. .</p>
        </div>
        <div id="rules-2" style="display:none" class="container">
            <h2>Выполнение заданий</h2>
            <p>После регистрации и входа на сайт, команде предоставляется список заданий, которые она может выполнять на свой выбор. За каждое выполненное задание команда получает соответствующее количество очков, в зависимости от его сложности (количество очков указано на главной странице рядом с названием задания). Команда не может выполнять одновременно больше одного задания. При выборе какого либо, другие становятся неактивными. Список заданий для всех команд один. Если задание в процессе выполнения одной из команд, другая не может выполнять его параллельно. Выполнение этого же задания возможно лишь в том случае, если команда, которая первой взялась за его выполнение, не справилась и решила отказаться от него, нажав кнопку отказа в меню задания. После этого оно снова станет активным в общем списке.
                    <br> Все задания делятся на 2 типа: уникальные и общие. Уникальное выполняется только одной командой за соответствующее количество очков. Общее задание одинаково для всех и выполняется всеми командами (по желанию). Очки распределяются между командами в соответствии с результатами.</p>
        </div>
        <div id="rules-3" style="display:none" class="container">
            <h3>Порядок действий для выполнения задания </h3>
            <p>
                <ul>
                    <li>выбрать из общего списка одно доступное задание</li>
                    <li>ознакомиться с требованиями конкретного задания (после клика на названии раскрывается описание)
                        </li>
                    <li>для того чтобы приступить к его выполнению нажать кнопку “За дело!”
                        </li>
                    <li>после выполнения всех требований указанных в задании нажать на кнопку “Хочу сдать!” и загрузить необходимые материалы (фото, видео итд)
                        </li>
                </ul>
            </p>
        </div>
        <div id="rules-4" style="display:none" class="container">
            <h3>Порядок проверки задания и возможные варианты развития событий</h3>
                <p>После вышеуказанных действий информация отправляется администратору на проверку. При проверке задания возможны следующие случаи:
                    <br> а) Если все выполнено корректно, администратор подтверждает правильность выполнения, после чего на ваш баланс зачисляются соответствующие баллы и вы можете приступать к следующему (этот процесс может занять некоторое время, которое вы можете использовать для отдыха или ознакомления с требованиями других заданий). 
                    <br> б) Если задание выполнено неточно или по каким либо причинам загружен несоответствующий контент (фото, видео или текст подтверждающие выполнение задания), администратор отправит задание на доработку. 
                    <br> в) Если задание выполнено кардинально неправильно или отправлено на проверку более трех раз подряд, администратор имеет право не засчитать его выполнение вашей команде, и изменить его статус на “доступно всем”. После чего задание будет доступно для выполнения всеми командами в том числе и вам. 
                    <br><i style="text-decoration: underline">При всех вариантах развития событий в общем телеграмм-канале будет появляться соответствующая информация. Внимательно следите за ней, пока не убедитесь в том, что задание сдано и вы получили соответствующие баллы. </i>
                </p>
        </div>
        <div id="rules-5" style="display:none" class="container">
            <h3>Передвижение по городу</h3>
            <p>Во время выполнения заданий команда обязана передвигаться вместе, нельзя разделяться. 
                Каждый участник обязан проявлять максимальную осторожность при езде по дорогам, на перекрестках 
                и других оживленных местах, соблюдая все правила безопасности!
            </p>
        </div>
        <div id="rules-6" style="display:none" class="container">
            <h3>Жульничество</h3>
            <p>При выполнении заданий запрещается жульничать. В тех случаях где нет возможности проверить честность выполнения задания со стороны администратора, фальсификация результатов остается на вашей христианской совести. Если вы обнаружили явный недочет со стороны организаторов, при котором вы можете кардинально улучшить свои позиции, просьба также поступить по совести уважая усилия других участников, и сообщить о выявленном недочете администратору.</p>
        </div>
        <div id="rules-7" style="display:none" class="container">
            <h3>Необходимое техническое оснащение</h3>
            <p>Велосипед для каждого члена команды в исправном состоянии. Телефон с камерой и вспышкой, с подключением к мобильному интернету. Power bank.</p>
            <h3>Окончание квеста</h3>
            <p>Квест может закончится в двух случаях: 1й - истечение отведенного времени, 2й - выполнение и подтверждение администратором всех заданий.</p>            
        </div>
        <div id="rules-8" style="display:none" class="container">
            <h3>Подсчет очков</h3>
            <p>Подсчет очков и оглашение победителя осуществляется на общей встрече по завершении квеста.</p>
            <p> Команда организаторов оставляет за собой право определения степени сложности заданий и соответствующее 
                количество очков за него. Если вам кажется что задание чрезмерно сложно а количество балов за его выполнение 
                несправедливо мало (или наоборот), данная тема не подлежит оспариванию. Также все спорные моменты возникающие 
                в непредвиденных ситуациях разрешаются администратором и не подлежат оспариванию. 
                <br> Все команды соревнуются в одинаковых условиях.
            </p>
        </div>
        <hr class="my-4">
        <div class="col-md-6 offset-md-4">
            <button style="font-size:1rem" role="button" class="btn btn-success" :disabled="isDisabledGreenBtn" @click="clickGreenBtn">
                Понял-принял! (<span id="timer">{{ seconds }}</span>)
            </button>
            <button style="font-size:1rem" role="button" class="btn btn-cancel" @click="clickRedBtn">
                Я все знаю!
            </button>
        </div>
    </div>
</template>

<script>
export default {
    props: [],
    data: function() {
        return {
            activeRule: 1,
            score: 0,
            seconds: 15,
            isDisabledGreenBtn: true,
        }
    },
    computed: {
        
    },
    mounted() {
        this.reloadTimer();
    },
    methods: {
        setScore() {
            return window.axios.put('/set-score', {score: this.score})
                .catch(error => {
                    console.log(error.response);
                });
        },
        slideRules() {
            let nextRule = $("#rules-" + this.activeRule).slideUp('slow').next('div');
            if (nextRule.length == 0) {
                this.setScore()
                .then(res => {
                    $('#endRules').show();
                    // redirect
                    setTimeout(() => window.location.replace("/game"),3000);
                });    
            } else {
                nextRule.slideDown('slow');
                this.activeRule++;
            }
        },
        timer() {
            this.seconds--;
            
            if (this.seconds == 0) {
                this.activateGreenBtn();
                setTimeout(function(){},1000);
            } else{
                setTimeout(this.timer, 1000);
            }
        },
        reloadTimer(isFullReload = true) {
            this.seconds = 15;
            if (isFullReload) setTimeout(this.timer, 1000);
        },
        activateGreenBtn() {
            this.isDisabledGreenBtn = false;
        },
        disableGreenBtn() {
            this.isDisabledGreenBtn = true;
        },
        clickGreenBtn() {
            this.score += 5;
            this.slideRules();
            this.disableGreenBtn();
            this.reloadTimer();
        },
        clickRedBtn() {
            this.slideRules();
            this.disableGreenBtn();
            this.reloadTimer(false);
        }
    },
    
}
</script>

<style>

</style>